var _0x5072=['apply','defineProperty','__esModule','cluster','dbName','setup','createV8Extension','init','existCheck','pg_extension','extname','create\x20extension\x20plv8;','query','setStartProcess','ALTER\x20DATABASE\x20\x22','\x22\x20SET\x20plv8.start_proc\x20=\x20\x27','fetchCode','FileManager','readStream','utf8','PLV8Init','plv8_init','pg_proc','create','create\x20or\x20replace\x20function\x20plv8_init()\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20returns\x20void\x20as\x20$$\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20cache\x20=\x20{};\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20load\x20=\x20function(key,\x20source)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20var\x20module\x20=\x20{exports:\x20{}};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20eval(\x22(function(module,\x20exports)\x20{\x22\x20+\x20source\x20+\x20\x22;\x20})\x22)(module,\x20module.exports);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20//\x20store\x20in\x20cache\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20cache[key]\x20=\x20module.exports;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20return\x20module.exports;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20};\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20require\x20=\x20function(module)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if(cache[module])\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20return\x20cache[module];\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20var\x20rows\x20=\x20plv8.execute(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27select\x20source\x20from\x20\x22PLV8Module\x22\x20where\x20module\x20=\x20$1\x27,\x20[module]\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20);\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if(rows.length\x20===\x200)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20plv8.elog(NOTICE,\x20\x27cannot\x20load\x20module:\x20\x27\x20+\x20module);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20return\x20null;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20return\x20load(module,\x20rows[0].source);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20var\x20query\x20=\x20\x27select\x20module,\x20source\x20from\x20\x22PLV8Module\x22\x20where\x20autoload\x20=\x20true\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20plv8.execute(query).forEach(function(row)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20load(row.module,\x20row.source);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20});\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20$$\x20language\x20plv8;','select\x20*\x20from\x20\x22','rows','length','insertModule','\x27,\x20','__awaiter','next','throw','done','value'];(function(_0x35cedf,_0x20e120){var _0x2f76a7=function(_0x2b7851){while(--_0x2b7851){_0x35cedf['push'](_0x35cedf['shift']());}};_0x2f76a7(++_0x20e120);}(_0x5072,0x136));var _0x3fe8=function(_0x43c705,_0x2668d4){_0x43c705=_0x43c705-0x0;var _0x49aa7f=_0x5072[_0x43c705];return _0x49aa7f;};'use strict';var __awaiter=this&&this[_0x3fe8('0x0')]||function(_0x3393ba,_0x45adcf,_0x390e84,_0x1b2fe2){return new(_0x390e84||(_0x390e84=Promise))(function(_0x4c7247,_0x45c387){function _0xcc2856(_0x2e5b48){try{_0x7870a4(_0x1b2fe2[_0x3fe8('0x1')](_0x2e5b48));}catch(_0xde9860){_0x45c387(_0xde9860);}}function _0x5aadeb(_0x365952){try{_0x7870a4(_0x1b2fe2[_0x3fe8('0x2')](_0x365952));}catch(_0x324515){_0x45c387(_0x324515);}}function _0x7870a4(_0x2613b6){_0x2613b6[_0x3fe8('0x3')]?_0x4c7247(_0x2613b6[_0x3fe8('0x4')]):new _0x390e84(function(_0x4c7247){_0x4c7247(_0x2613b6[_0x3fe8('0x4')]);})['then'](_0xcc2856,_0x5aadeb);}_0x7870a4((_0x1b2fe2=_0x1b2fe2[_0x3fe8('0x5')](_0x3393ba,_0x45adcf||[]))[_0x3fe8('0x1')]());});};Object[_0x3fe8('0x6')](exports,_0x3fe8('0x7'),{'value':!![]});const file_manager_1=require('../file-manager/file-manager');const cluster=require(_0x3fe8('0x8'));class PLV8{constructor(_0x1b152f,_0x130625){this['pg']=_0x1b152f;this[_0x3fe8('0x9')]=_0x130625;}[_0x3fe8('0xa')](){return __awaiter(this,void 0x0,void 0x0,function*(){return new Promise(_0x4ddfce=>__awaiter(this,void 0x0,void 0x0,function*(){yield this[_0x3fe8('0xb')]();yield this['PLV8Init'](this['dbName']);_0x4ddfce(!![]);}));});}[_0x3fe8('0xc')](){return __awaiter(this,void 0x0,void 0x0,function*(){return new Promise(_0x4b9d24=>__awaiter(this,void 0x0,void 0x0,function*(){yield this[_0x3fe8('0xa')]();_0x4b9d24(this);}));});}[_0x3fe8('0xb')](){return __awaiter(this,void 0x0,void 0x0,function*(){return new Promise(_0x113554=>__awaiter(this,void 0x0,void 0x0,function*(){let _0x38b521=yield this[_0x3fe8('0xd')](_0x3fe8('0xe'),_0x3fe8('0xf'),'plv8');if(!_0x38b521){const _0x26d459=_0x3fe8('0x10');this['pg'][_0x3fe8('0x11')](_0x26d459,(_0x15eef0,_0x3c56f9)=>{if(_0x15eef0){_0x113554(_0x15eef0);}else{_0x113554(_0x3c56f9);}});}else{_0x113554({});}}));});}[_0x3fe8('0x12')](_0x25ffd4,_0x59ea4a){return __awaiter(this,void 0x0,void 0x0,function*(){return new Promise(_0xafd9e0=>{const _0x4b5f43=_0x3fe8('0x13')+_0x59ea4a+_0x3fe8('0x14')+_0x25ffd4+'\x27;';this['pg']['query'](_0x4b5f43,(_0x1e33ab,_0x4c6f7b)=>{if(_0x1e33ab){_0xafd9e0(_0x1e33ab);}else{_0xafd9e0(_0x4c6f7b);}});});});}[_0x3fe8('0x15')](_0x23694b){const _0x52af2d=new file_manager_1[(_0x3fe8('0x16'))]();return new Promise(_0x3dec08=>{_0x52af2d[_0x3fe8('0x17')](_0x23694b,{'returnType':_0x3fe8('0x18')},_0x18acc1=>{_0x3dec08(_0x18acc1);});});}[_0x3fe8('0x19')](_0x3f1b1d){return __awaiter(this,void 0x0,void 0x0,function*(){return new Promise(_0x66a57a=>__awaiter(this,void 0x0,void 0x0,function*(){yield this[_0x3fe8('0x12')](_0x3fe8('0x1a'),_0x3f1b1d);const _0x538a8b=yield this['existCheck'](_0x3fe8('0x1b'),'proname','plv8_init');if(!_0x538a8b){let _0x545b1c=yield this[_0x3fe8('0x1c')](_0x3fe8('0x1d'));if(_0x545b1c){_0x66a57a(_0x545b1c);}}else{_0x66a57a({});}}));});}[_0x3fe8('0x1c')](_0x256cc5){return new Promise((_0x132e8e,_0x39bed4)=>{this['pg'][_0x3fe8('0x11')](_0x256cc5,(_0x705591,_0xb9af5f)=>{if(_0x705591){_0x132e8e(_0x705591);}else{_0x132e8e(_0xb9af5f);}});});}[_0x3fe8('0xd')](_0x48fb3d,_0x57a4af,_0x494423){return new Promise(_0x3fef90=>{let _0x958899=_0x3fe8('0x1e')+_0x48fb3d+'\x22\x20where\x20\x22'+_0x57a4af+'\x22\x20=\x20\x27'+_0x494423+'\x27;';this['pg'][_0x3fe8('0x11')](_0x958899,(_0x5b53b6,_0x2bf001)=>{if(_0x5b53b6){_0x3fef90(_0x5b53b6);}else{const _0x487944=_0x2bf001&&_0x2bf001[_0x3fe8('0x1f')][_0x3fe8('0x20')]>0x0;_0x3fef90(_0x487944);}});});}[_0x3fe8('0x21')](_0x2e6a75,_0x186885,_0x5df4dc){return __awaiter(this,void 0x0,void 0x0,function*(){return new Promise(_0x332017=>{let _0x52fd41='insert\x20into\x20\x22PLV8Module\x22\x20(module,\x20autoload,\x20source,\x20created_by,\x20updated_by)\x20values\x20(\x27'+_0x2e6a75+_0x3fe8('0x22')+_0x186885+',\x20\x27'+_0x5df4dc+'\x27,\x20\x27SYS\x27,\x20\x27SYS\x27);';this['pg'][_0x3fe8('0x11')](_0x52fd41,(_0x4ee4aa,_0x20abc7)=>{if(_0x4ee4aa){_0x332017(_0x4ee4aa);}else{_0x332017(_0x20abc7);}});});});}}exports['PLV8']=PLV8;